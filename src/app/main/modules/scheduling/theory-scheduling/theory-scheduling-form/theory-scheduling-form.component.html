<section class="scheduling">

  <app-header-inside-page> </app-header-inside-page>
  <app-header-buttons [buttons]="buttons"
                      [disabled]="disabled"
                      [object]="schedule"
                      [valid]="formSchedule.valid"
                      [enableHeader]="false"
                      (buttonsEmmiter)="buttonsActions($event)">
  </app-header-buttons>

  <form [formGroup]="formSchedule"
        fxLayout="row layout-wrap"
        fxLayoutAlign='start start'>

    <div fxFlex="49%"
         fxLayoutGap="24px"
         fxLayout="row layout-wrap">

      <h1 class="w-100">Dados do Agendamento</h1>

      <div class="pos-relative"
           fxFlex="45%"
           fxFlex.gt-lg="30%">
        <app-course-schedulling-autocomplete class="auto-complete"
                                             formControlName="curso"
                                             [fControl]="formSchedule.controls.curso">
        </app-course-schedulling-autocomplete>
      </div>

      <mat-form-field appearance="outline"
                      fxFlex="45%"
                      fxFlex.gt-lg="30%">
        <mat-label>MODELO</mat-label>
        <mat-select formControlName="modelo">
          <mat-option *ngFor="let item of classModel"
                      [value]="item">
            {{item.descricao}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline"
                      fxFlex="45%"
                      fxFlex.gt-lg="30%">
        <mat-label>LIMITE PARTICIPANTES</mat-label>
        <input matInput
               #quantity
               type="number"
               [maxlength]="maxQuantityClass"
               (keyup)="setMaxQuantity(quantity)"
               formControlName="limiteParticipantes">
      </mat-form-field>

      <mat-form-field appearance="outline"
                      fxFlex="45%"
                      fxFlex.gt-lg="30%">
        <mat-label>SITUAÇÃO</mat-label>
        <input matInput
               type="string"
               formControlName="situacao">
      </mat-form-field>

      <mat-form-field appearance="outline"
                      fxFlex="45%"
                      fxFlex.gt-lg="30%">
        <mat-label>TIPO</mat-label>
        <mat-select required
                    formControlName="tipoAulaId">
          <mat-option *ngFor="let class of tipeClassConst"
                      [value]="class.id">{{class.descricao}}</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="pos-relative"
           fxFlex="30%">
        <app-service-schedulling-autocomplete class="auto-complete"
                                              formControlName="servico"
                                              [fControl]="formSchedule.controls.servico">
        </app-service-schedulling-autocomplete>
      </div>

      <span fxFlex="30%"
            class="mb-4">
        <mat-checkbox color="primary"
                      formControlName="permiteCancelamento">Permite Cancelamento</mat-checkbox>
      </span>

      <div class="pos-relative"
           fxFlex="95.5%">
        <app-cfc-schedulling-autocomplete class="auto-complete"
                                          formControlName="cfc"
                                          [fControl]="formSchedule.controls.cfc">
        </app-cfc-schedulling-autocomplete>
      </div>

      <div class="pos-relative"
           fxFlex="95.5%">
        <app-instructor-schedulling-autocomplete class="auto-complete"
                                                 formControlName="instrutor"
                                                 [fControl]="formSchedule.controls.instrutor">
        </app-instructor-schedulling-autocomplete>
      </div>
    </div>
    <div fxFlex="49%"
         fxLayoutGap="24px"
         fxLayout="row layout-wrap"
         class="pl-4 scheduling__box-right">
      <h1>Dados Das Aulas</h1>
      <mat-form-field fxFlex="95.5%"
                      appearance="outline">
        <mat-label>CONTEÚDO PROGRAMÁTICO</mat-label>
        <input type="text"
               placeholder="Conteúdo Programático"
               aria-label="Conteúdo Programático"
               matInput
               formControlName="conteudoProgramatico">
      </mat-form-field>


      <mat-form-field fxFlex="30%"
                      appearance="outline">
        <mat-label>INTERVALO (MINUTOS)</mat-label>
        <input type="number"
               placeholder="Intervalo"
               aria-label="Intervalo"
               matInput
               formControlName="intervalo">
      </mat-form-field>

      <div fxFlex="60%"
           class="ml-2">
        <label class="w-100 d-block mb-2">TURNO</label>
        <mat-radio-group formControlName="turno"
                         color="primary"
                         fxLayout="row"
                         fxLayoutAlign="start center"
                         fxLayoutGap="48px">
          <mat-radio-button value="MANHA">
            MANHÃ
          </mat-radio-button>
          <mat-radio-button value="TARDE">
            TARDE
          </mat-radio-button>
          <mat-radio-button value="NOITE">
            NOITE
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <div fxFlex="45%"
           fxFlex.gt-lg="25%"
           class="pos-relative">
        <app-date-input class="auto-complete"
                        formControlName="agenda"
                        [label]="'DATA'"
                        [fControl]="formSchedule.controls.agenda">
        </app-date-input>
      </div>

      <mat-form-field fxFlex="45%"
                      fxFlex.gt-lg="22%"
                      appearance="outline">
        <mat-label>INÍCIO</mat-label>
        <input #inicioElement
               aria-label="Início"
               formControlName="inicio"
               matInput
               placeholder="Início"
               type="text"
               [dropSpecialCharacters]="false"
               [mask]="'00:00'"
               (focusout)="checkFieldInicio()">
      </mat-form-field>

      <mat-form-field fxFlex="45%"
                      fxFlex.gt-lg="22%"
                      appearance="outline">
        <mat-label>FIM</mat-label>
        <input #fimElement
               aria-label="Fim"
               formControlName="fim"
               matInput
               placeholder="Fim"
               type="text"
               [dropSpecialCharacters]="false"
               [mask]="'00:00'"
               (focusout)="checkFieldFim()">
      </mat-form-field>

      <span fxFlex="22%"
            fxFlex.gt-lg="17%"
            class="mt-3">
        <button aria-label="gerar aulas"
                color="primary"
                mat-stroked-button
                type="button"
                (click)="createItensClass()">
          <mat-icon>school</mat-icon>
          GERAR AULAS
        </button>
      </span>

      <form [formGroup]="formClass"
            fxFlex="100%">
        <table mat-table
               class="scheduling__class-table"
               #tableExpanded
               *ngIf="classTableDataSource.data.length > 0; else noData"
               [dataSource]="classTableDataSource">

          <ng-container matColumnDef="nroAula">
            <th mat-header-cell
                *matHeaderCellDef>NÚMERO DA AULA </th>
            <td mat-cell
                *matCellDef="let element">
              <input matInput
                     placeholder="Informe"
                     type="text"
                     [formControlName]="'nroAula_' + element.posicao">
            </td>
          </ng-container>

          <ng-container matColumnDef="curso">
            <th mat-header-cell
                *matHeaderCellDef>CURSO</th>
            <td mat-cell
                *matCellDef="let element">
              <div class="scheduling__class-table-curso">
                <app-course-schedulling-autocomplete class="auto-complete"
                                                     formControlName="{{'curso_' + element.posicao}}"
                                                     [label]="false"
                                                     [fControl]="formClass.controls['curso_' + element.posicao]">
                </app-course-schedulling-autocomplete>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="conteudoProgramatico">
            <th mat-header-cell
                *matHeaderCellDef>CONTEUDO PROGRAMÁTICO</th>
            <td mat-cell
                *matCellDef="let element">
              <input matInput
                     placeholder="Informe"
                     type="text"
                     [formControlName]="'conteudo_' + element.posicao">
            </td>
          </ng-container>

          <ng-container matColumnDef="inicio">
            <th mat-header-cell
                *matHeaderCellDef>INÍCIO</th>
            <td mat-cell
                *matCellDef="let element">
              <input matInput
                     placeholder="Informe"
                     type="text"
                     [formControlName]="'inicio_' + element.posicao">
            </td>
          </ng-container>

          <ng-container matColumnDef="fim">
            <th mat-header-cell
                *matHeaderCellDef>FIM </th>
            <td mat-cell
                *matCellDef="let element">
              <input matInput
                     placeholder="Informe"
                     type="text"
                     [formControlName]="'fim_' + element.posicao">
            </td>
          </ng-container>

          <tr mat-header-row
              *matHeaderRowDef="displayedColumnsClassTable"></tr>
          <tr mat-row
              *matRowDef="let row; columns: displayedColumnsClassTable;"></tr>
        </table>

        <ng-template #noData>
          <ng-container *ngIf="classTableDataSource.data.length <= 0;">
            <div class="txt-left">
              <p>O campo <strong>Conteúdo Programático</strong> não é obrigatório. No entanto, caso o preencha, o
                mesmo
                será replicado para todos os agendamentos, poupando esforço para informar este linha a linha.</p>
              <p>Caso deseje editar o <strong>Consteúdo Programatico</strong> ou o <strong>Número da aula</strong>
                basta
                dar um clique sobre o item (após a geração dos dados da aula), e realizar a edição deste.</p>
              <p>Vamos lá? Informe os campos <strong>Conteúdo programátivo, Turno, Data, Início e Fim</strong>, para
                começarmos a criação de um agendamento.</p>
            </div>
          </ng-container>
        </ng-template>
      </form>
    </div>
  </form>

  <mat-divider class="w-100 my-3"></mat-divider>

  <div class="mt-5"
       *ngIf="schedule.id">
    <div class="w-100 mb-4 generic-info"
         fxLayout="row"
         fxLayoutAlign="space-between start">
      <div>
        <h1 class="w-100 generic-info__title">Candidados Agendados</h1>
        <span class="w-100 generic-info__text">Aqui você confere os candidados já agendados para a aula.</span>
      </div>
      <button mat-stroked-button
              color="primary"
              class="add-button mt-1"
              (click)="addCandidate()">
        <mat-icon>save</mat-icon>
        ADICIONAR CANDIDATO
      </button>
    </div>
    <app-table-custom [tableData]="tableData"></app-table-custom>
  </div>
</section>
